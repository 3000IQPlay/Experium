package dev._3000IQPlay.experium.features.modules.exploit;

import dev._3000IQPlay.experium.event.events.PacketEvent;
import dev._3000IQPlay.experium.features.gui.ExperiumGui;
import dev._3000IQPlay.experium.features.modules.Module;
import dev._3000IQPlay.experium.features.setting.Setting;
import net.minecraft.client.gui.GuiScreen;
import net.minecraft.client.gui.inventory.GuiContainer;
import net.minecraft.network.play.client.CPacketCloseWindow;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class Backpack
        extends Module {
    public Setting<Boolean> open = this.register(new Setting<Boolean>("Open", false));
    public Setting<Boolean> close = this.register(new Setting<Boolean>("Close", false));
    private GuiScreen cancelledGui = null;

    public Backpack() {
        super("Backpack", "Manipulates container packets", Module.Category.EXPLOIT, true, false, false);
    }

    @SubscribeEvent
    public void onPacketSend(PacketEvent.Send e) {
        if (Backpack.fullNullCheck() || this.isDisabled()) {
            return;
        }
        if (e.getPacket() instanceof CPacketCloseWindow && this.close.getValue().booleanValue()) {
            e.setCanceled(true);
        }
    }

    @Override
    public void onUpdate() {
        if (this.isDisabled()) {
            return;
        }
        if (Backpack.mc.currentScreen instanceof GuiContainer && this.open.getValue().booleanValue()) {
            if (Backpack.mc.currentScreen instanceof ExperiumGui) {
                return;
            }
            this.cancelledGui = Backpack.mc.currentScreen;
            Backpack.mc.currentScreen = null;
        }
    }

    @Override
    public void onDisable() {
        if (!Backpack.fullNullCheck() && this.cancelledGui != null && this.open.getValue().booleanValue()) {
            mc.displayGuiScreen(this.cancelledGui);
        }
        this.cancelledGui = null;
    }
}

